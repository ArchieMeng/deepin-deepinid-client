<html>

<head>
    <meta charset="UTF-8">
    <link href="style.css" rel="stylesheet">
    <title>Error</title>
</head>

<body>
    <div id="error_main">
        <img id="cloud_offline" src="cloud_offline.svg">

        <div class="error_title">
            云同步登录
        </div>

        <div class="error_content">
            但前没有网络连接，请联网后重试！
        </div>


        <div class="submit_bt">
            <input type="submit" id="submit_bt" data-value-function="getSubmitButtonText" />
        </div>
    </div>

    <script>
        function QT_TRANSLATE_NOOP(obj, str) {
            return function (element) {
                nativeExec(function (channel, element) {
                    channel.objects.client.gettext(str, function (result) {
                        console.log(element)
                        console.log(result)
                        element.value = result
                    })
                }, element)
            }
        }

        window.getSubmitButtonText = function (data) {
            return QT_TRANSLATE_NOOP("dsc::SyncClient", "Close")(data)
        }

        var elements = document.querySelectorAll('*[data-value-function]');
        for (var i = 0; i < elements.length; i++) {
            var valueFunctionName = elements[i].getAttribute('data-value-function');
            window[valueFunctionName](elements[i]);
        }

        function nativeExec(handler, data) {
            if (window['QWebChannel'] && window['qt']) {
                window['QWebChannel'](window['qt'].webChannelTransport, channel => {
                    handler(channel, data);
                });
            }
        }

        document.addEventListener("DOMContentLoaded", function (event) {
            console.log("DOM fully loaded and parsed");

            var register = document.getElementById('submit_bt');
            register.addEventListener('click', function (e) {
                var targetWindow = window.opener || window.parent;
                if (targetWindow) {
                    nativeExec(function (channel, data) {
                        channel.objects.client.close();
                    }, "")
                    e.preventDefault();
                }
            });
        });
    </script>
</body>

</html>